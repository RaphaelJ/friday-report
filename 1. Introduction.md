# Introduction

This document will describe a project I'm working on for about two years. This
is not the sole personal project I worked on during this period, but it is
probably the largest and the most serious one.

The project is named **friday** and is a *image processing framework* written
in the strongly typed functional programming language **Haskell**.

I started thinking about a functional image processing library while doing an
internship in computer vision three years ago. I noticed that most bugs I
encountered were avoidable if the library we used (*OpenCV*) was written in a
more functional way, and with a stronger type system.

While a lot of image processing libraries already exist, designing one from
scratch for a functional programming language is actually quite interesting.

The four distinguishing features of this project are:

* A reliance on a strongly typed programming language to detect programming
  errors directly at compile time. I will give in the course of this document
  a few examples of bugs which can be avoided at compile time with *friday*
  while they will silently occur at runtime with other libraries.
* The ability to fuse image transformations.
  For example, if one wishes to apply a rotation on a resized image, he can
  use *friday* and the *Haskell* compiler to generate a single loop that will
  automatically combine the resizing and the rotating operations into a single
  algorithm, removing the need to store the intermediate resized image [1].
* The ability to automatically parallelize algorithms to use multiple
  processors.
  The library is able to parallelize upon request image transformations, even
  these which have been generated by the fusion mechanism.
* Being extremely generic. One who wants to create new algorithms, new
  pixel color-spaces or new ways to store an image [2] will be able to reuse
  the advanced type checking features and both the fusion and automatic
  parallelization mechanisms.

The library is more like a set of *building blocks to write image processing
algorithms in a functional programming style* than a collection of image
processing algorithms.
Because of that, the expression *image processing framework* seems more
appropriate than *image processing library*.

[1] This feature might seem odd for programmers unfamiliar with functional
programming. The technique involved, named *deforestation* or *stream fusion*,
is however well known to functional programmers. A similar feature exists in
some list, array and stream libraries.

[2] One use case involving the creation of a new image type could be to
interface with an existing library or hardware (GPU ...).

## Other features

The library currently supports four color-spaces: RGB, RGBA, HSV and grey-scale
pixels. Images can be converted between these color-spaces.

The following features and algorithms have been implemented:

* various image transformations: resize, crop, vertical and horizontal
  flip, flood fill ...
* various filters: morphological transformations (dilation and erosion),
  blurring (mean and Gaussian blurs) and derivative operators (Sobel and Scharr
  operators), with a generic interface to create new filters from kernels.
* non-adaptive, adaptive, Otsu and SCW thresholding methods.
* edge detection using Canny's algorithm.
* full type-safe support for masked images.
* histogram computation, histogram comparisons and image equalization by their
  histograms.

Loading and saving images from and to disk is delayed to a C library, with
wrappers provided by
[the separate friday-devil package](https://github.com/RaphaelJ/friday-devil).

## Availability and source code

The library was released for the first time with its online documentation on
the [official *Haskell*'s package
repository](https://hackage.haskell.org/package/friday) in August 2014 and a 
second major version was released in January 2015.
A third experimental version is currently developed and is available in the
*v0.3* branch of the [GitHub source
repository](http://github.com/RaphaelJ/friday).

According to the *Haskell*'s package repository statistics, about 150 users
compile and install the library each month, making it the third most used image
processing package in the repository.

## Document structure

I assume that the reader has no knowledge of the *Haskell* programming 
language. The following section gives some *Haskell* basics and
introduces the language's syntax and type system. This is mandatory
to understand the other parts of the document as *Haskell* is a very unique
programming language.

The second section exposes how *friday* design diverges from others image
processing libraries by relying on a strong and type system, and how this
enables safety and reusability.

The third section talks about the fusion and parallelization mechanisms and how
they are implemented. Both mechanisms are very tightly related. The section also
briefly addresses performances.
